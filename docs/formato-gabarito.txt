

=== Rationale ===

O formato do gabarito usado nas correções dos algoritmos de rameau
tenta ser, ao mesmo tempo, tão preciso quanto uma análise manual dos
acordes de uma peça quanto ser conversível para formatos menos
precisos na hora de validar os resultados de cada algoritmo. Para
fazer isso, algumas características são essenciais:

 0. A segmentação deve aparecer de forma não-ambígua no formato de
 gabarito
 
 1. O formato deve ser capaz de indicar que um dado segmento é
 ambíguo, e, com isso, mostrar as possibilidades para ele

 2. O formato deve ser capaz de representar suspensões e segmentos
 melódicos

Além disso ele, como será gerado manualmente, deve ser simples de se
escrever e, como será processado por código lisp, deve ser
compreensível como uma mini-linguagem embutida.


=== Estrutura ===

A estrutura do formato de gabarito é simples:

 0. Um acorde é representado pela lista (<tônica> <tipo> <inversão>
 <adições>...), onde

   0.0: <tônica> representa a nota tônica do acorde (em codificação
   tonal, usando a sintaxe do lilypond)

   0.1: <tipo> representa o tipo da tríade: maj para maior, min para
   menor, dim para diminuto, ita para sexta italiana, ale para sexta
   alemã, fra para sexta francesa, aug para aumentada, e inc para
   incompleto (i.e. sem a terça).
  
   0.2: <inversão> é um número inteiro representando a inversão do
   acorde. 0 é a forma natural, 1 a primeira inversão e assim
   sucessivamente

   0.3: <adições> é uma sequência (opcional) de notas adicionadas à
   tríade. Por exemplo, um 7- representa uma sétima diminuta, e um 5+
   uma quinta aumentada.


    Ex: um acorde se meio diminuto, assim, seria representado por
        (b dim 0 7)


 1. Um segmento melódico é representado pela lista (m! <notas>),
 onde <notas> é uma sequência de notas com todas as notas do segmento
 melódico.

  ex: (m! dis g)

 2. Um segmento com uma suspensão é representado por (:sus <info>),
 onde <info> é uma sequência com a informação necessária para se
 entender esse acorde (FIXME: especificar qual é)

 3. Caso haja mais de uma opção de acorde para um segmento, na parte
 correspondente a esse segmento se coloca uma lista com as opções de
 acorde.

  ex: um segmento ambíguo pode ser ((c maj 0) (d min 0 7))

 4. Caso vários segmentos sucessivos tenham a mesma análise,
 escreve-se (* n <analise>), onde n é o número de segmentos com aquela
 análise.

  ex: (* 3 ((c maj 0) (d min 0 7)))


Ou seja, em EBNF:

  acorde := (<tonica> <tipo> <inversao> <adicoes>...)
  melodico := (m! <nota>...)
  suspenso := (:sus *)
  individual := acorde | melodico | suspenso
  ambiguo := (individual ... individual)
  repetidos := (* <numero> individual) | (* <numero> ambiguo)
  analise := individual | ambiguo | repetido
  
  
O formato geral é uma sequência de análises, uma para cada segmento
mínimo da peça a ser analisada. Um segmento mínimo é o intervalo entre
dois pontos de partição consecutivos.

Obs: A análise não é feita em segmentos mínimos, e sim em segmentos,
     ela só  é expandida para segmentos mínimos na hora de fazer o
     gabarito.


